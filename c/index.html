<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hyperon C: Hyperon Bindings for C</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Hyperon C
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Hyperon Bindings for C </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<p>This documentation specifically covers the API for extending Hyperon with modules implemented in C as well as integrating Hyperon into a C project. For a more complete overview of Hyperon, you should look here: <b>TODO: Where?</b></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
API Conventions</h3>
<p>The HyperonC API is intended to be a light weight layer over the native Rust implementation, and is designed to impose as little runtime performance overhead as possible. It is not necessary to be familiar with Rust to use HyperonC, but it might clarify the paterns because some of the API semantics come directly from ownership and borrowing in Rust.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Object Lifecycle Pattern</h3>
<p>When a Hyperon object is created through the creation function, it is given to you, the caller, by value. For example <span class="tt">atom_sym()</span> returns an <span class="tt">atom_t</span> struct. You own that <span class="tt">atom_t</span> and you must free it when it's no longer needed, using the corresponding free function; <span class="tt">atom_free()</span> in the case of <span class="tt">atom_t</span>.</p>
<div class="fragment"><div class="line"><span class="comment">// Create the atom</span></div>
<div class="line"><a class="code hl_struct" href="structatom__t.html">atom_t</a> test_atom = <a class="code hl_function" href="group__atom__group.html#ga419a4d0d779527802b50326a88c37332">atom_sym</a>(<span class="stringliteral">&quot;test_atom&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// We need to free the atom because we own it</span></div>
<div class="line"><a class="code hl_function" href="group__atom__group.html#ga16c30a26365362d512d39e7bfb657ec9">atom_free</a>(test_atom);</div>
<div class="ttc" id="agroup__atom__group_html_ga16c30a26365362d512d39e7bfb657ec9"><div class="ttname"><a href="group__atom__group.html#ga16c30a26365362d512d39e7bfb657ec9">atom_free</a></div><div class="ttdeci">void atom_free(atom_t atom)</div><div class="ttdoc">Frees an atom and all associated resources.</div></div>
<div class="ttc" id="agroup__atom__group_html_ga419a4d0d779527802b50326a88c37332"><div class="ttname"><a href="group__atom__group.html#ga419a4d0d779527802b50326a88c37332">atom_sym</a></div><div class="ttdeci">atom_t atom_sym(const char *name)</div><div class="ttdoc">Create a new Symbol atom with the specified name.</div></div>
<div class="ttc" id="astructatom__t_html"><div class="ttname"><a href="structatom__t.html">atom_t</a></div><div class="ttdoc">Represents an Atom of any type.</div></div>
</div><!-- fragment --><p>However, if you pass the object by value to another function, that function takes ownership and now you are no longer responsible for freeing the object. For example, <span class="tt">atom_vec_push()</span> takes an <span class="tt">atom_t</span> argument, passed by value. This means the passed atom is now owned by the vec, and it is the responsibility of the vec to free the atom.</p>
<div class="fragment"><div class="line"><span class="comment">// Create an empty vec (list container) for atoms</span></div>
<div class="line"><a class="code hl_struct" href="structatom__vec__t.html">atom_vec_t</a> test_vec = <a class="code hl_function" href="group__atom__vec__group.html#ga8c3e42f61643a7eb534bf4b5e0a6ef2c">atom_vec_new</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a test atom and push it into the vec</span></div>
<div class="line"><span class="comment">// Now the vec takes responsibility for the atom (ownership)</span></div>
<div class="line"><a class="code hl_struct" href="structatom__t.html">atom_t</a> test_atom = <a class="code hl_function" href="group__atom__group.html#ga419a4d0d779527802b50326a88c37332">atom_sym</a>(<span class="stringliteral">&quot;test_atom&quot;</span>);</div>
<div class="line"><a class="code hl_function" href="group__atom__vec__group.html#gaea795aaedfe4bd01d6f6654517c1cc8b">atom_vec_push</a>(&amp;test_vec, test_atom);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// We still own the vec so we must free it</span></div>
<div class="line"><a class="code hl_function" href="group__atom__vec__group.html#ga882320d488d178423eeb6c742c88bdc2">atom_vec_free</a>(test_vec);</div>
<div class="ttc" id="agroup__atom__vec__group_html_ga882320d488d178423eeb6c742c88bdc2"><div class="ttname"><a href="group__atom__vec__group.html#ga882320d488d178423eeb6c742c88bdc2">atom_vec_free</a></div><div class="ttdeci">void atom_vec_free(struct atom_vec_t vec)</div><div class="ttdoc">Frees a atom_vec_t</div></div>
<div class="ttc" id="agroup__atom__vec__group_html_ga8c3e42f61643a7eb534bf4b5e0a6ef2c"><div class="ttname"><a href="group__atom__vec__group.html#ga8c3e42f61643a7eb534bf4b5e0a6ef2c">atom_vec_new</a></div><div class="ttdeci">struct atom_vec_t atom_vec_new(void)</div><div class="ttdoc">Creates a new empty atom_vec_t</div></div>
<div class="ttc" id="agroup__atom__vec__group_html_gaea795aaedfe4bd01d6f6654517c1cc8b"><div class="ttname"><a href="group__atom__vec__group.html#gaea795aaedfe4bd01d6f6654517c1cc8b">atom_vec_push</a></div><div class="ttdeci">void atom_vec_push(struct atom_vec_t *vec, atom_t atom)</div><div class="ttdoc">Push the atom onto the end of the vec.</div></div>
<div class="ttc" id="astructatom__vec__t_html"><div class="ttname"><a href="structatom__vec__t.html">atom_vec_t</a></div><div class="ttdoc">Contains a vector (list) of Atoms.</div><div class="ttdef"><b>Definition</b> hyperon.h:246</div></div>
</div><!-- fragment --><p>Some functions return pointers or smart pointers (structs with types ending in "ref_t") pointing to other objects. When working with a pointer or ref_t smart pointer, you must be cognizant of the life cycle of the referenced object. For example, <span class="tt">atom_vec_get()</span> returns an <span class="tt">atom_ref_t</span> to refer to an atom within the vec. That reference will become invalid if the <span class="tt">atom_vec_t</span> the pointer refers into is freed or changed in any way. The Rust borrow checker ensures these constraints are never violated, but in C you must take that responsibility yourself.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a vec with an atom</span></div>
<div class="line"><a class="code hl_struct" href="structatom__vec__t.html">atom_vec_t</a> test_vec = <a class="code hl_function" href="group__atom__vec__group.html#ga8c3e42f61643a7eb534bf4b5e0a6ef2c">atom_vec_new</a>();</div>
<div class="line"><a class="code hl_function" href="group__atom__vec__group.html#gaea795aaedfe4bd01d6f6654517c1cc8b">atom_vec_push</a>(&amp;test_vec, <a class="code hl_function" href="group__atom__group.html#ga419a4d0d779527802b50326a88c37332">atom_sym</a>(<span class="stringliteral">&quot;test_atom&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Borrow the atom back from the vec as a reference</span></div>
<div class="line"><a class="code hl_struct" href="structatom__ref__t.html">atom_ref_t</a> borrowed_atom = <a class="code hl_function" href="group__atom__vec__group.html#gad74a4fa33a95d268654ca76182536921">atom_vec_get</a>(&amp;test_vec, 0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the atom&#39;s text description</span></div>
<div class="line"><span class="keywordtype">char</span> buffer[64];</div>
<div class="line"><a class="code hl_function" href="group__atom__group.html#gad6b7bebbdd94cf9b0579e1f12e398533">atom_to_str</a>(&amp;borrowed_atom, buffer, 64);</div>
<div class="line">printf(<span class="stringliteral">&quot;atom = %s&quot;</span>, buffer);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// We&#39;re done with the vec for some reason, so free it</span></div>
<div class="line"><a class="code hl_function" href="group__atom__vec__group.html#ga882320d488d178423eeb6c742c88bdc2">atom_vec_free</a>(test_vec);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// NO!!!! The atom that `borrowed_atom` points to was freed with the vec</span></div>
<div class="line"><span class="comment">//atom_t new_atom = atom_clone(&amp;borrowed_atom);</span></div>
<div class="ttc" id="agroup__atom__group_html_gad6b7bebbdd94cf9b0579e1f12e398533"><div class="ttname"><a href="group__atom__group.html#gad6b7bebbdd94cf9b0579e1f12e398533">atom_to_str</a></div><div class="ttdeci">uintptr_t atom_to_str(const atom_ref_t *atom, char *buf, uintptr_t buf_len)</div><div class="ttdoc">Renders a human-readable text description of an atom.</div></div>
<div class="ttc" id="agroup__atom__vec__group_html_gad74a4fa33a95d268654ca76182536921"><div class="ttname"><a href="group__atom__vec__group.html#gad74a4fa33a95d268654ca76182536921">atom_vec_get</a></div><div class="ttdeci">atom_ref_t atom_vec_get(const struct atom_vec_t *vec, uintptr_t idx)</div><div class="ttdoc">Access an atom at a specified index in a vec.</div></div>
<div class="ttc" id="astructatom__ref__t_html"><div class="ttname"><a href="structatom__ref__t.html">atom_ref_t</a></div><div class="ttdoc">Refers to an Atom owned by another object.</div></div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
